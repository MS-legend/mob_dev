{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport { useState, useEffect, useCallback } from 'react';\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nvar useStorage = function useStorage(key, defaultValue) {\n  var _useState = useState(defaultValue),\n    _useState2 = _slicedToArray(_useState, 2),\n    value = _useState2[0],\n    setValue = _useState2[1];\n  var _useState3 = useState(true),\n    _useState4 = _slicedToArray(_useState3, 2),\n    loading = _useState4[0],\n    setLoading = _useState4[1];\n  var _useState5 = useState(null),\n    _useState6 = _slicedToArray(_useState5, 2),\n    error = _useState6[0],\n    setError = _useState6[1];\n  useEffect(function () {\n    loadData();\n  }, [key]);\n  useEffect(function () {\n    if (!loading) {\n      saveData();\n    }\n  }, [value, key]);\n  var loadData = useCallback(_asyncToGenerator(function* () {\n    try {\n      setLoading(true);\n      setError(null);\n      var storedValue = yield AsyncStorage.getItem(key);\n      if (storedValue !== null) {\n        try {\n          var parsedValue = JSON.parse(storedValue);\n          setValue(parsedValue);\n        } catch (parseError) {\n          console.error('Error parsing stored value:', parseError);\n          setValue(defaultValue);\n          yield AsyncStorage.setItem(key, JSON.stringify(defaultValue));\n        }\n      }\n    } catch (error) {\n      console.error('Error loading from storage:', error);\n      setError(error.message);\n      Alert.alert('Ошибка загрузки', 'Не удалось загрузить данные');\n    } finally {\n      setLoading(false);\n    }\n  }), [key, defaultValue]);\n  var saveData = useCallback(_asyncToGenerator(function* () {\n    if (loading) return;\n    try {\n      setError(null);\n      yield AsyncStorage.setItem(key, JSON.stringify(value));\n    } catch (error) {\n      console.error('Error saving to storage:', error);\n      setError(error.message);\n      Alert.alert('Ошибка сохранения', 'Не удалось сохранить данные');\n    }\n  }), [value, key, loading]);\n  var clearData = useCallback(_asyncToGenerator(function* () {\n    try {\n      setError(null);\n      yield AsyncStorage.removeItem(key);\n      setValue(defaultValue);\n    } catch (error) {\n      console.error('Error clearing storage:', error);\n      setError(error.message);\n      Alert.alert('Ошибка', 'Не удалось очистить данные');\n    }\n  }), [key, defaultValue]);\n  var updateValue = useCallback(function (newValue) {\n    setValue(newValue);\n  }, []);\n  return {\n    value: value,\n    setValue: updateValue,\n    loading: loading,\n    error: error,\n    clearData: clearData,\n    refetch: loadData\n  };\n};\nexport default useStorage;","map":{"version":3,"names":["useState","useEffect","useCallback","Alert","AsyncStorage","useStorage","key","defaultValue","_useState","_useState2","_slicedToArray","value","setValue","_useState3","_useState4","loading","setLoading","_useState5","_useState6","error","setError","loadData","saveData","_asyncToGenerator","storedValue","getItem","parsedValue","JSON","parse","parseError","console","setItem","stringify","message","alert","clearData","removeItem","updateValue","newValue","refetch"],"sources":["/home/ms/Документы/Мобильная разработка/Код/src/hooks/useStorage.js"],"sourcesContent":["// src/hooks/useStorage.js - хук для работы с AsyncStorage с улучшенной обработкой ошибок\nimport { useState, useEffect, useCallback } from 'react';\nimport { Alert } from 'react-native';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\n\nconst useStorage = (key, defaultValue) => {\n  const [value, setValue] = useState(defaultValue);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // Загрузка данных при монтировании компонента\n  useEffect(() => {\n    loadData();\n  }, [key]);\n\n  // Сохранение данных при изменении value\n  useEffect(() => {\n    if (!loading) {\n      saveData();\n    }\n  }, [value, key]);\n\n  const loadData = useCallback(async () => {\n    try {\n      setLoading(true);\n      setError(null);\n      const storedValue = await AsyncStorage.getItem(key);\n      \n      if (storedValue !== null) {\n        try {\n          const parsedValue = JSON.parse(storedValue);\n          setValue(parsedValue);\n        } catch (parseError) {\n          console.error('Error parsing stored value:', parseError);\n          setValue(defaultValue);\n          // Восстанавливаем корректное значение\n          await AsyncStorage.setItem(key, JSON.stringify(defaultValue));\n        }\n      }\n    } catch (error) {\n      console.error('Error loading from storage:', error);\n      setError(error.message);\n      Alert.alert('Ошибка загрузки', 'Не удалось загрузить данные');\n    } finally {\n      setLoading(false);\n    }\n  }, [key, defaultValue]);\n\n  const saveData = useCallback(async () => {\n    if (loading) return;\n    \n    try {\n      setError(null);\n      await AsyncStorage.setItem(key, JSON.stringify(value));\n    } catch (error) {\n      console.error('Error saving to storage:', error);\n      setError(error.message);\n      Alert.alert('Ошибка сохранения', 'Не удалось сохранить данные');\n    }\n  }, [value, key, loading]);\n\n  const clearData = useCallback(async () => {\n    try {\n      setError(null);\n      await AsyncStorage.removeItem(key);\n      setValue(defaultValue);\n    } catch (error) {\n      console.error('Error clearing storage:', error);\n      setError(error.message);\n      Alert.alert('Ошибка', 'Не удалось очистить данные');\n    }\n  }, [key, defaultValue]);\n\n  const updateValue = useCallback((newValue) => {\n    setValue(newValue);\n  }, []);\n\n  return { \n    value, \n    setValue: updateValue, \n    loading, \n    error,\n    clearData,\n    refetch: loadData\n  };\n};\n\nexport default useStorage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}