{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nimport { useState, useEffect, useRef } from 'react';\nimport Alert from \"react-native-web/dist/exports/Alert\";\nvar useApi = function useApi(url) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    data = _useState2[0],\n    setData = _useState2[1];\n  var _useState3 = useState(true),\n    _useState4 = _slicedToArray(_useState3, 2),\n    loading = _useState4[0],\n    setLoading = _useState4[1];\n  var _useState5 = useState(null),\n    _useState6 = _slicedToArray(_useState5, 2),\n    error = _useState6[0],\n    setError = _useState6[1];\n  var abortControllerRef = useRef(null);\n  var fetchData = useCallback(_asyncToGenerator(function* () {\n    if (!url) return;\n    if (abortControllerRef.current) {\n      abortControllerRef.current.abort();\n    }\n    abortControllerRef.current = new AbortController();\n    try {\n      setLoading(true);\n      setError(null);\n      var response = yield fetch(url, _objectSpread({\n        signal: abortControllerRef.current.signal\n      }, options));\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      var result = yield response.json();\n      setData(result);\n      return result;\n    } catch (err) {\n      if (err.name !== 'AbortError') {\n        console.error('API Error:', err);\n        setError(err.message);\n        if (!err.message.includes('abort')) {\n          Alert.alert('Ошибка загрузки', 'Не удалось загрузить данные с сервера');\n        }\n      }\n    } finally {\n      setLoading(false);\n    }\n  }), [url, JSON.stringify(options)]);\n  useEffect(function () {\n    fetchData();\n    return function () {\n      if (abortControllerRef.current) {\n        abortControllerRef.current.abort();\n      }\n    };\n  }, [fetchData]);\n  var refetch = useCallback(function () {\n    return fetchData();\n  }, [fetchData]);\n  var clearError = useCallback(function () {\n    setError(null);\n  }, []);\n  return {\n    data: data,\n    loading: loading,\n    error: error,\n    refetch: refetch,\n    clearError: clearError\n  };\n};\nexport default useApi;","map":{"version":3,"names":["useState","useEffect","useRef","Alert","useApi","url","options","arguments","length","undefined","_useState","_useState2","_slicedToArray","data","setData","_useState3","_useState4","loading","setLoading","_useState5","_useState6","error","setError","abortControllerRef","fetchData","useCallback","_asyncToGenerator","current","abort","AbortController","response","fetch","_objectSpread","signal","ok","Error","status","result","json","err","name","console","message","includes","alert","JSON","stringify","refetch","clearError"],"sources":["/home/ms/Документы/Мобильная разработка/Код/src/hooks/useApi.js"],"sourcesContent":["// src/hooks/useApi.js - хук для работы с API с улучшенной обработкой ошибок\nimport { useState, useEffect, useRef } from 'react';\nimport { Alert } from 'react-native';\n\nconst useApi = (url, options = {}) => {\n  const [data, setData] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const abortControllerRef = useRef(null);\n\n  // Функция для выполнения запроса\n  const fetchData = useCallback(async () => {\n    if (!url) return;\n\n    // Отменяем предыдущий запрос если он есть\n    if (abortControllerRef.current) {\n      abortControllerRef.current.abort();\n    }\n\n    // Создаем новый AbortController для текущего запроса\n    abortControllerRef.current = new AbortController();\n\n    try {\n      setLoading(true);\n      setError(null);\n      \n      const response = await fetch(url, {\n        signal: abortControllerRef.current.signal,\n        ...options\n      });\n      \n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      \n      const result = await response.json();\n      setData(result);\n      return result;\n    } catch (err) {\n      // Игнорируем ошибки отмены запроса\n      if (err.name !== 'AbortError') {\n        console.error('API Error:', err);\n        setError(err.message);\n        \n        // Показываем alert только для критических ошибок\n        if (!err.message.includes('abort')) {\n          Alert.alert('Ошибка загрузки', 'Не удалось загрузить данные с сервера');\n        }\n      }\n    } finally {\n      setLoading(false);\n    }\n  }, [url, JSON.stringify(options)]);\n\n  useEffect(() => {\n    fetchData();\n\n    // Функция очистки - отменяем запрос при размонтировании\n    return () => {\n      if (abortControllerRef.current) {\n        abortControllerRef.current.abort();\n      }\n    };\n  }, [fetchData]);\n\n  const refetch = useCallback(() => {\n    return fetchData();\n  }, [fetchData]);\n\n  const clearError = useCallback(() => {\n    setError(null);\n  }, []);\n\n  return { \n    data, \n    loading, \n    error, \n    refetch,\n    clearError\n  };\n};\n\nexport default useApi;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}